---
title: "Multi‑Path AIC Selection: Wisconsin Breast Cancer (Logistic)"
output:
  html_document:
    toc: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{MPSS with AIC on Wisconsin Breast Cancer}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```r
knitr::opts_chunk$set(message = FALSE, warning = FALSE, fig.width = 7, fig.height = 4)
library(mpssAIC)
```

# Data

We use the classic **Wisconsin Breast Cancer** dataset via `mlbench::BreastCancer` (benign/malignant).

```r
if (!requireNamespace("mlbench", quietly = TRUE)) {
  stop("Please install 'mlbench' to build this vignette: install.packages('mlbench')")
}
data("BreastCancer", package = "mlbench")
bc <- mlbench::BreastCancer
bc <- subset(bc, complete.cases(bc))
bc$Class <- factor(bc$Class, levels = c("benign","malignant"))
y <- as.integer(bc$Class == "malignant")
X <- bc[ , !(names(bc) %in% c("Id","Class")), drop = FALSE]
X <- data.frame(lapply(X, function(v) as.numeric(as.character(v))))
```

# Train/Test Split

```r
set.seed(123)
n <- nrow(X)
idx <- sample.int(n, size = floor(0.7*n))
Xtr <- X[idx, ]; ytr <- y[idx]
Xte <- X[-idx, ]; yte <- y[-idx]
```

# Multi‑Path Search

```r
forest <- build_paths(Xtr, ytr, family = "binomial",
                      K = 4, eps = 1e-3, delta = 2, L = 60, trace = TRUE)
head(forest$aic_by_model[order(forest$aic_by_model$AIC), ], 10)
```

# Stability (B = 50 bootstraps)

```r
stab <- stability(Xtr, ytr, B = 50, resample = "bootstrap",
                  build_args = list(family = "binomial", K = 4, eps = 1e-3, delta = 2, L = 60))
sort(stab$pi, decreasing = TRUE)[1:10]
```

# Plausible Models (Δ = 2, τ = 0.5)

```r
plaus <- plausible_models(forest, pi = stab$pi, Delta = 2, tau = 0.5,
                          drop_jaccard = TRUE, jaccard_threshold = 0.9,
                          attach_fits = TRUE, X = Xtr, y = ytr)
plaus
```

# Test Metrics

```r
if (nrow(plaus) > 0) {
  fit <- plaus$fit[[1]]
  pr  <- predict(fit, newdata = data.frame(y = NA, Xtr), type = "response")
  # align columns in case
  pr  <- predict(fit, newdata = data.frame(Xte), type = "response")
  confusion_metrics(yte, pr)
}
```

# Notes on Defaults

- `K=4` because we expect a compact set of nuclei morphology predictors to be sufficient.
- `eps=1e-3` to ensure each step improves the parent’s AIC.
- `delta=2` keeps near-best children per parent.
- `L=60` caps frontier growth.
- `B=50` bootstraps to estimate stability.
- `Delta=2`, `tau=0.5` balances goodness-of-fit and feature reliability.
