---
title: "Multi-Path AIC and Rashomon Sets on the Efron Diabetes Dataset"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Multi-Path AIC and Rashomon Sets on the Efron Diabetes Dataset}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

In this vignette, we use the **mpssAIC** pipeline on the `efron2004` diabetes dataset  
(Efron et al., 2004) to illustrate:

- multi-path AIC model selection,
- construction of a *Rashomon set* of plausible models,
- assessment of variable stability via bootstrap resampling, and
- evaluation of predictive performance using test-set RMSE.

The goal is to show how the exported functions  
`build_paths()`, `stability()`, and `plausible_models()`  
work together to reveal multiple well-supported models, rather than relying on a single greedy solution.


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)

# Do NOT install packages inside a vignette.
# Assume 'care' is available (it's listed in Suggests in DESCRIPTION).
# If it's missing, the user can install it manually.

if (!requireNamespace("care", quietly = TRUE)) {
  stop("The vignette requires the 'care' package. Please install it with install.packages('care').")
}

library(mpssAIC)
library(care)
set.seed(123)

```

Introduction
This vignette demonstrates the use of the mpssAIC package on the
efron2004 diabetes dataset (Efron et al., 2004), available in the care package.
We illustrate multi-path model selection, variable stability, and plausible model evaluation.

```{r}
data(efron2004)
X <- as.data.frame(efron2004$x)
y <- as.numeric(efron2004$y)

n <- nrow(X)
idx_train <- sample(seq_len(n), size = floor(0.8*n))
idx_test <- setdiff(seq_len(n), idx_train)

X_train <- X[idx_train, ]
y_train <- y[idx_train]

X_test <- X[idx_test, ]
y_test <- y[idx_test]

```


Build multi-path forward selection forest

```{r}
forest <- build_paths(
X_train, y_train,
family = "gaussian",
K = 12,
eps = 1e-6,
delta = 2,
L = 40
)

```

Compute stability
```{r}
pi_vec <- stability(
X_train, y_train,
family = "gaussian",
B = 40,
resample = "bootstrap",
K = 12,
eps = 1e-6,
delta = 2,
L = 40
)

```

Plausible models
```{r}
plaus <- plausible_models(
forest,
pi = pi_vec,
Delta = 2,
tau = 0.6
)

plaus


```
 Evaluate best model on test data
```{r}

if (nrow(plaus) > 0) {
  # extract indices of variables in the best plausible model
  best_key <- plaus$key[1]
  best_idx <- as.integer(strsplit(best_key, ",")[[1]])

  # subset training and test predictors
  X_train_sub <- X_train[, best_idx, drop = FALSE]
  X_test_sub  <- X_test[,  best_idx, drop = FALSE]

  # build data frames for modeling
  df_train <- data.frame(y = y_train, X_train_sub)
  df_test  <- data.frame(X_test_sub)

  # fit Gaussian model on training data
  fit <- glm(y ~ ., data = df_train, family = gaussian())

  # predict on test data
  preds <- predict(fit, newdata = df_test)

  # compute RMSE on test set
  rmse <- sqrt(mean((preds - y_test)^2))
  rmse
}
```

## Conclusion

In this example, the most plausible model in the Rashomon set was a simple one-variable model,  
which achieved a test-set RMSE of approximately 1.0.

This demonstrates two important ideas behind the **multi-path AIC** workflow:

1. Multiple models can have nearly identical AIC, forming a *Rashomon set* of explanations.  
2. Combining AIC with **stability** and **out-of-sample RMSE** helps identify models that are both  
   interpretable and well-supported by the data.

The `mpssAIC` package provides a principled way to explore model uncertainty and select robust,  
predictive models without relying on a single stepwise path.

